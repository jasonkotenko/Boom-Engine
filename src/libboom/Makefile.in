PREFIX = INSTALL_PREFIX
OSX_TARGET = libboom.dylib
LINUX_TARGET = libboom.so

LIB_CXXFLAGS = `sdl-config --cflags` `pkg-config --cflags libpng sigc++-2.0`
LIB_LDFLAGS = `sdl-config --libs | sed 's/-lSDLmain//'`  `pkg-config --libs libpng sigc++-2.0` -lbz2

OPTIMIZATIONS = -fomit-frame-pointer -pipe

OSX_CXXFLAGS = -D_OSX_
OSX_LDFLAGS = -framework OpenGL -framework GLUT -dynamiclib

LINUX_CXXFLAGS = -march=i686
LINUX_LDFLAGS = -lGL -lGLU -lglut -L/usr/X11R6/lib -lXi -shared

CXXFLAGS = $(OPTIMIZATIONS) $(LIB_CXXFLAGS) -Wall $(OS_CXXFLAGS)
LDFLAGS = $(LIB_LDFLAGS) $(OS_LDFLAGS)


OBJECTS =	log.o \
			vfs.o \
			tarfile.o \
			event.o \
			stringfuncs.o \
			loadpng.o \
			graphics.o \
			scene.o \
			state.o \
			interface.o \
			sdl_interface.o \
			boom.o

all::$(OS_TARGET)

libboom.so: $(OBJECTS)
	$(CXX) $(LDFLAGS) $(OBJECTS) -o $@
	touch ../demo/test.cpp

libboom.dylib: $(OBJECTS)
	$(CXX) $(LDFLAGS) $(OBJECTS) -o $@
	touch ../demo/test.cpp

log.o: log.h

vfs.o: vfs.h log.h

tarfile.o: tarfile.h

event.o: event.h log.h

stringfuncs.o: stringfuncs.h

loadpng.o: loadpng.h

graphics.o: graphics.h loadpng.h log.h

scene.o: scene.h graphics.h log.h

state.o: state.h log.h

boom.o: boom.h log.h

interface.o: interface.h state.h

sdl_interface.o: sdl_interface.h interface.h event.h state.h

install:
	install $(OS_TARGET) $(PREFIX)/lib

uninstall:
	rm $(PREFIX)/lib/$(OS_TARGET)

clean:
	rm -rf *.o $(OS_TARGET) core
